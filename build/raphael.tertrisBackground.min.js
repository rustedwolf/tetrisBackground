/*! raphael.tertrisBackground 2015-04-06 */
function TetrisBackgroud(a){var b=document.getElementById(a);this.paper=Raphael(a,b.offsetWidth,b.offsetHeight),this.shapeCount=7,this.blockSize=10,this.spacing=1,this.fallingSpeed=400,this.blockSizeSpaced=blockSize+spacing,this.blockColor="#17bee3",this.gridWidth=Math.floor(b.offsetWidth/blockSizeSpaced),this.gridHeight=Math.floor(b.offsetHeight/blockSizeSpaced),this.grid=[new Array(this.gridWidth),new Array(this.gridHeight)],this.prepareContainer=function(){for(var a=(Math.floor(.9*yBlocks),Math.floor(xBlocks/2),0);xBlocks>=a;a++){blockPlacement[a]=Array(yBlocks);for(var b=fillPart;yBlocks>=b;b++){var c=101*Math.random(),d=0,e=0;e=0!==b?100*(b-fillPart)/(yBlocks+1-fillPart):0,d=a<=xHalf?0!==a?100*a/xHalf:0:100*(xBlocks-a+1)/xHalf;var f=.8*(d+e);f>c?(blockPlacement[a][b]=!0,generateBlock(blockSizeSpaced,blockInfo,blockSizeSpaced*a,blockSizeSpaced*b)):blockPlacement[a][b]=!1}}},this.drawBlock=function(a,b,c){var d=this.paper.rect(b,c,a,a);return d.attr({fill:this.blockColor,"stroke-width":0,"stroke-linejoin":"miter"}),d},this.prepareContainer()}function generateBlock(a,b,c,d){var e=R.rect(a*b[0]+c,a*b[1]+d,blockSize,blockSize).attr({fill:blockColor,"stroke-width":0,"stroke-linejoin":"miter"});return e}function generateShape(a){var b=Math.floor(Math.random()*a.blocks.length),c={size:a.size,rotate:b,blocks:a.blocks[b],faling:!1,xOffset:0,yOffset:0,objects:R.set()},d=c.blocks,e=Math.floor(Math.random()*(containerWidth/blockSizeSpaced-c.size)),f=e*blockSizeSpaced,g=b%2!==0?0:-blockSizeSpaced;c.xOffset=e,b%2!==0&&(c.yOffset=-1),2===c.size&&(f+=blockSizeSpaced,g+=blockSizeSpaced);for(var h in c.blocks)c.objects.push(generateBlock(blockSizeSpaced,d[h],f,g));return c}function dropShape(a,b){var c=a.rotate%2!==0?1:0,d=0;2===a.size&&(c=1,d=1);var e=!0;a.blocks.forEach(function(b){e&&(void 0!==blockPlacement[b[0]+a.xOffset]?(e=!blockPlacement[b[0]+a.xOffset+d][b[1]+a.yOffset+c],b[1]+a.yOffset+c>=yBlocks&&(e=!1)):e=!(b[1]>=yBlocks))}),e?(a.yOffset=a.yOffset+1,a.faling||(a.faling=!0,a.objects.animate({transform:"t0,"+a.yOffset*blockSizeSpaced},b/2,"<>",function(){a.faling=!1,setTimeout(function(){return dropShape(a,b)},b)}))):a.objects.animate({opacity:0},1e3,"<>",function(){a.objects.remove(),a.objects=null,a=null,timeoutDrop()})}function fillBottom(){for(var a=Math.floor(.9*yBlocks),b=Math.floor(xBlocks/2),c=[0,0],d=0;xBlocks>=d;d++){blockPlacement[d]=Array(yBlocks);for(var e=a;yBlocks>=e;e++){var f=101*Math.random(),g=0,h=0;h=0!==e?100*(e-a)/(yBlocks+1-a):0,g=b>=d?0!==d?100*d/b:0:100*(xBlocks-d+1)/b;var i=.8*(g+h);i>f?(blockPlacement[d][e]=!0,generateBlock(blockSizeSpaced,c,blockSizeSpaced*d,blockSizeSpaced*e)):blockPlacement[d][e]=!1}}}function timeoutDrop(){var a=24e3*Math.random();setTimeout(function(){var a=Object.keys(shapesData),b=Math.floor(Math.random()*Object.keys(shapesData).length),c=generateShape(shapesData[a[b]]);dropShape(c,fallingSpeed)},a)}function dropShapes(){for(var a=0;a<shapeCount;a++)timeoutDrop()}function drawSentence(a){var b=0;a.forEach(function(a){b+=letters[a].w+2}),b>0&&(b-=2);var c=Math.floor((xBlocks-b)/2);a.forEach(function(a){letters[a].data.forEach(function(a){var b=c,d=yOffset;setTimeout(function(){var c=generateBlock(blockSizeSpaced,a,blockSizeSpaced*b,blockSizeSpaced*d);c.attr({opacity:0}),c.animate({opacity:1},1e3)},delay),delay+=100}),c=c+letters[a].w+2}),yOffset+=8}var targetObj=document.getElementById(this.targetContainer),xBlocks=Math.floor(targetObj.offsetWidth/blockSizeSpaced),yBlocks=Math.floor(targetObj.offsetHeight/blockSizeSpaced),containerWidth=xBlocks*blockSizeSpaced,containerHeight=yBlocks*blockSizeSpaced,R=Raphael(this.targetContainer,containerWidth,containerHeight),shapesData={I:{size:4,blocks:Array([[0,1],[1,1],[2,1],[3,1]],[[2,0],[2,1],[2,2],[2,3]])},T:{size:3,blocks:Array([[0,1],[1,1],[2,1],[1,2]],[[1,0],[0,1],[1,1],[1,2]],[[1,1],[0,2],[1,2],[2,2]],[[1,0],[1,1],[2,1],[1,2]])},L:{size:3,blocks:Array([[0,1],[1,1],[2,1],[0,2]],[[0,0],[1,0],[1,1],[1,2]],[[2,1],[0,2],[1,2],[2,2]],[[1,0],[1,1],[1,2],[2,2]])},J:{size:3,blocks:Array([[0,1],[1,1],[2,1],[2,2]],[[1,0],[1,1],[0,2],[1,2]],[[0,1],[0,2],[1,2],[2,2]],[[1,0],[2,0],[1,1],[1,2]])},S:{size:3,blocks:Array([[1,1],[2,1],[0,2],[1,2]],[[0,0],[0,1],[1,1],[1,2]])},Z:{size:3,blocks:Array([[0,1],[1,1],[1,2],[2,2]],[[2,0],[1,1],[2,1],[1,2]])},O:{size:2,blocks:Array([[0,0],[1,0],[0,1],[1,1]])}};fillBottom();var interval=dropShapes(),letters={0:{w:5,data:[[0,0],[4,0],[0,1],[1,1],[3,1],[4,1],[0,2],[2,2],[4,2],[0,3],[4,3],[0,4],[4,4]]},1:{w:4,data:[[0,0],[3,0],[0,1],[2,1],[0,2],[1,2],[0,3],[2,3],[0,4],[3,4]]},2:{w:4,data:[[0,0],[1,0],[2,0],[3,0],[0,1],[0,2],[1,2],[0,3],[0,4],[1,4],[2,4],[3,4],[2,5],[3,4]]},3:{w:4,data:[[1,0],[2,0],[0,1],[3,1],[0,2],[1,2],[2,2],[3,2],[0,3],[3,3],[0,4],[3,4]]},4:{w:4,data:[[0,0],[3,0],[0,1],[3,1],[0,2],[1,2],[2,2],[3,2],[0,3],[3,3],[0,4],[3,4]]},5:{w:4,data:[[0,0],[3,0],[0,1],[3,1],[0,2],[3,2],[0,3],[3,3],[1,4],[2,4]]},6:{w:1,data:[[0,0],[0,1],[0,2],[0,3],[0,4]]},7:{w:1,data:[[0,0],[0,1],[0,2],[0,4]]},8:{w:4,data:[[1,0],[2,0],[0,1],[3,1],[0,2],[0,3],[3,3],[1,4],[2,4]]},9:{w:4,data:[[1,0],[2,0],[0,1],[3,1],[0,2],[3,2],[0,3],[3,3],[1,4],[2,4]]},10:{w:2,data:[[0,4],[1,4],[1,5]]}},fistLine=[1,9,8,4,3,0],secondLine=[8,6,2,10],thirdLine=[1,9,8,6,5,7],delay=7e3,yOffset=10;